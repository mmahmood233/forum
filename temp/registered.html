<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: auto;
        }
        header {
            position: fixed;
            text-align: center;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #333;
            color: #fff;
            padding: 20px;
            z-index: 1000;
        }
        header h1 {
            margin: 0;
        }
        .post-container {
            background: #fff;
            padding: 20px;
            margin-top: 50px;
            border: 1px solid #e4e4e4;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-height: 500px;
            overflow: auto;
        }
        .post {
            background: #f9f9f9;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .post h3 {
            margin: 0 0 10px 0;
        }
        .post p {
            margin: 0;
        }
        footer {
            background: #333;
            color: #fff;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        .green {
            color:green;
        }
        .red {
            color: red;
        }
        .cont {
                table-layout: left; 
        }
    </style>
</head>
<body>
    <header>
        <h1>MAIN</h1>
        <table id="cont">
            <tr><button><a href="doLogin">Login</a></button></tr>
            <tr><button><a href="doRegister">Register</a></button></tr>
            <tr><button><a href="createP">Create Post</a></button></tr>
        </table>
    </header>

    <div class="container">
        <div class="post-container">
            
            {{range .}}
            <div class="post">
                <h3>{{.User.Username}}</h3>
                <p>{{.Post.PostContent}}</p>
                <small>Posted on: {{.Post.CreatedAt}}</small>
                <script src="https://use.fontawesome.com/fe459689b4.js"></script>
                                <br>
                            <button class="btn" id="green" data-count="0"><i class="fa fa-thumbs-up fa-lg" aria-hidden="true"></i> <span class="count">0</span></button>
                            <button class="btn" id="red" data-count="0"><i class="fa fa-thumbs-down fa-lg" aria-hidden="true"></i> <span class="count">0</span></button>
                <form action="/createC?postID={{.Post.PostID}}" method="post">
                    <textarea name="commentCont" placeholder="Comment Content" required></textarea>
                    <button type="submit">Add Comment</button>
                </form>
                <div class="comments">
                    {{range .Comments}}
                    <div class="comment">
                        <p>{{.CommentContent}}</p>
                        <small>Commented by: {{.Username}} </small><br>
                        <small>on {{.CreatedAt}}</small>
                        <script src="https://use.fontawesome.com/fe459689b4.js"></script>
                                <br>
                            <button class="btn" id="green" data-count="0"><i class="fa fa-thumbs-up fa-lg" aria-hidden="true"></i> <span class="count">0</span></button>
                            <button class="btn" id="red" data-count="0"><i class="fa fa-thumbs-down fa-lg" aria-hidden="true"></i> <span class="count">0</span></button>
                    </div>
                    {{end}}
                </div>
            </div>
            {{else}}
            <p>No posts yet.</p>
            {{end}}
        </div>
    </div>

    <footer>
        <p>Web Forum &copy; 2024</p>
    </footer>
</body>
<script>
    var btns = document.querySelectorAll('.btn');
    
    btns.forEach(function(btn) {
      btn.setAttribute('data-count', '0');
      btn.querySelector('.count').textContent = '0';
    
      btn.addEventListener('click', function() {
        var count = parseInt(this.getAttribute('data-count'));
        var greenBtn = this.parentNode.querySelector('#green');
        var redBtn = this.parentNode.querySelector('#red');
        var isPost = this.parentNode.classList.contains('post');
    
        if (this.id === 'green') {
          if (greenBtn.classList.contains('clicked')) {
            // Green button has already been clicked
            greenBtn.classList.remove('clicked');
            greenBtn.classList.remove('green');
            count = 0;
          } else {
            // Remove the clicked class from the red button
            redBtn.classList.remove('clicked');
            redBtn.classList.remove('red');
            redBtn.querySelector('.count').textContent = '0';
            redBtn.setAttribute('data-count', '0');
    
            // Toggle the green button and update the count
            greenBtn.classList.toggle('green');
            count = (count === 0)? 1 : 0;
            greenBtn.setAttribute('data-count', count);
            greenBtn.querySelector('.count').textContent = count;
            greenBtn.classList.add('clicked');
    
            // Send feedback
            sendFeedback('like', this.parentNode.dataset.id, isPost);
          }
        } else {
          if (redBtn.classList.contains('clicked')) {
            // Red button has already been clicked
            redBtn.classList.remove('clicked');
            redBtn.classList.remove('red');
            count = 0;
          } else {
            // Remove the clicked class from the green button
            greenBtn.classList.remove('clicked');
            greenBtn.classList.remove('green');
            greenBtn.querySelector('.count').textContent = '0';
            greenBtn.setAttribute('data-count', '0');
    
            // Toggle the red button and update the count
            redBtn.classList.toggle('red');
            count = (count === 0)? 1 : 0;
            redBtn.setAttribute('data-count', count);
            redBtn.querySelector('.count').textContent = count;
            redBtn.classList.add('clicked');
    
            // Send feedback
            sendFeedback('dislike', this.parentNode.dataset.id, isPost);
          }
        }
    
        this.setAttribute('data-count', count);
        this.querySelector('.count').textContent = count;
      });
    
      btn.addEventListener('dblclick', function(event) {
        event.preventDefault();
      });
    });
    
    function SendFeedback(type, id, isPost) {
      fetch('/feedback', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          feedback: isPost? (type === 'like'? 'post_like' : 'post_dislike') : (type === 'like'? 'comment_like' : 'comment_dislike'),
          id: id,
        }),
      })
     .then(response => response.json())
     .then(data => {
        console.log('Success:', data);
      })
     .catch((error) => {
        console.error('Error:', error);
      });
    }
    </script>
</html>
